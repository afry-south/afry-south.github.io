self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[473],{1186:function(e){e.exports=JSON.parse('{"b":"_fa","d":"$fa","c":"aga","a":"bga"}')},1376:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},1943:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),c=n(1376);t.default=function(e,t){return void 0===e||e.__type||(e=c.default(e)),r.makeServiceRequest("FetchDataProviderResource",e,t)}},3605:function(e,t,n){"use strict";n.d(t,"j",(function(){return c})),n.d(t,"i",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"f",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return f})),n.d(t,"e",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return p}));var r=n(4),c=Object(r.action)("tryQueueGetWacInfo",(function(e){return{url:e}})),a=Object(r.action)("queueGetWacInfo",(function(e){return{url:e}})),o=Object(r.action)("processGetWacInfoQueue"),i=Object(r.action)("getWacInfoQueueShift"),u=Object(r.action)("onStartGetWacInfoOperation",(function(e){return{url:e}})),s=Object(r.action)("onFinishGetWacInfoOperation",(function(e){return{url:e}})),f=Object(r.action)("pushSupressedUrl",(function(e){return{url:e}})),d=Object(r.action)("onGetWacInfoSuccess",(function(e,t){return{url:e,wacUrlInfo:t}})),l=Object(r.action)("addGenericLinkClickListener",(function(e,t,n){return{element:e,isSafeLinkWrapped:t,isSafeLinkVerified:n}})),p=Object(r.action)("addOpenDocumentPreviewEventListener",(function(e,t,n,r,c){return{element:e,href:t,itemId:n,isSafeLinkWrapped:r,isSafeLinkVerified:c}}))},3606:function(e,t,n){"use strict";n.d(t,"h",(function(){return r})),n.d(t,"i",(function(){return c})),n.d(t,"e",(function(){return a})),n.d(t,"f",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return u})),n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return f})),n.d(t,"g",(function(){return d}));var r=108e6,c=2,a="SP_LINK_CLICK_EVENT_LISTENER",o="SP_LINK_MOUSEUP_EVENT_LISTENER",i="originalsrc",u="shash",s="data-auth",f="&reserved=0",d="Verified"},3607:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r=n(0),c=n(193),a=n(37),o=n(1376),i=n.n(o),u=n(1943),s=n.n(u),f=n(44);function d(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var u,d,l,p,b,O,v,h,j,m,S,w,g,P;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:u=new c.a("getWacInfoForOneDriveJsApi",{isCore:!0}),o&&u.addCustomData({redeemSharingLinkIfNecessary:o}),r.label=1;case 1:return r.trys.push([1,3,,4]),d=btoa(t),l="u!"+d.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),p=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],Object(a.f)("doc-SxS-jsApi-ODB-Readonly")&&(n=!1),b=p+"_api/v2.0/shares/"+l+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(n?"Open":"View"),O=new Object,o&&(O.prefer="redeemSharingLinkIfNecessary"),v=i()({ProviderType:e,Url:b,Headers:JSON.stringify(O)}),h=(new Date).getTime(),[4,s()(v)];case 2:if(200===(j=r.sent()).Status&&j.Body)return m=(new Date).getTime(),(S=JSON.parse(j.Body)).fetchStartTime=h,S.responseStartTime=m,S.openWith.wac.fileGetUrl=S["@content.downloadUrl"],S.openWith.wac.accessTokenExpiry&&(S.openWith.wac.accessTokenExpiry=new Date(Number(S.openWith.wac.accessTokenExpiry))),!n&&S.currentUserRole&&(S.currentUserRole.readOnly=!0),u.end(),[2,S];throw u.addCustomData({StatusCode:j.Status}),(w=j.Headers)&&(g=JSON.parse(w))&&u.addCustomData({SharePointError:g.SharePointError,SPClientServiceRequestDuration:g.SPClientServiceRequestDuration,SPRequestGuid:g.SPRequestGuid}),new Error("Result status is: "+j.Status+" or empty response body.");case 3:return P=r.sent(),u.endWithError("ServerError",P),f.d.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+P),[3,4];case 4:return[2,null]}}))}))}},3739:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(3910),c=n.n(r);function a(e,t,n,r,a){return void 0===n&&(n=!1),void 0===r&&(r=!1),c()({request:{Url:e,IsEdit:r,ProviderType:t,ShouldGrantAccess:n}},a)}},3769:function(e,t,n){"use strict";n.r(t);var r=n(3605),c=n(4094),a=n(4);Object(a.mutator)(r.f,(function(e){var t=e.url;c.a.activeGetWacInfoOperations.push(t)})),Object(a.mutator)(r.d,(function(e){var t=e.url;c.a.activeGetWacInfoOperations.splice(c.a.activeGetWacInfoOperations.indexOf(t),1)})),Object(a.mutator)(r.e,(function(e){var t=e.url,n=e.wacUrlInfo,r={time:Date.now(),wacUrlInfo:n};c.a.docLinkPreviewInfoMap.set(t,r)})),Object(a.mutator)(r.i,(function(e){var t=e.url;c.a.getWacInfoQueue.push(t)})),Object(a.mutator)(r.c,(function(){c.a.getWacInfoQueue.shift()})),Object(a.mutator)(r.h,(function(e){var t=e.url;c.a.suppressedUrls.push(t)}));var o=n(3606),i=n(7719),u=n(7720);Object(a.orchestrator)(r.a,(function(e){var t=e.element,n=e.isSafeLinkWrapped,r=e.isSafeLinkVerified,c=function(e){Object(u.a)(e,n,r,null)};t.addEventListener("click",c),t[o.e]=c;var a=function(e){Object(i.a)(e,n,r)};t.addEventListener("mouseup",a),t[o.f]=a}));var s=n(0),f=n(3739),d=n(3607),l=n(37),p=n(857),b=n(5468);function O(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,c,a,o;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,,9,10]),Object(r.f)(e),n=null,Object(l.f)("doc-SxS-jsApi-ODB-Links")?[4,Object(d.a)(0,e,!0)]:[3,6];case 1:return(c=i.sent())?[3,2]:(Object(r.h)(e),[2,null]);case 2:return a=Object(p.b)(c.name),(o=Object(p.e)(a))!==p.a.Word&&o!==p.a.Excel&&o!==p.a.PowerPoint?[3,3]:(n={wacUrl:c.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:c.openWith.wac.bootstrapperUrl,wopiSrcUrl:c.openWith.wac.wopiSrc,accessToken:c.openWith.wac.accessToken,accessTokenExpiry:c.openWith.wac.accessTokenExpiry,fileSize:c.size,fileGetUrl:c.openWith.wac.fileGetUrl,bundleInfo:c.officeBundle,fetchStartTime:c.fetchStartTime,responseStartTime:c.responseStartTime,openUrl:e,fileName:c.name},readOnly:c.currentUserRole.readOnly},[3,5]);case 3:return[4,v(e)];case 4:n=i.sent(),i.label=5;case 5:return[3,8];case 6:return[4,v(e)];case 7:n=i.sent(),i.label=8;case 8:return n&&Object(r.e)(e,n),t?[2,Object(b.a)(e)]:[2,null];case 9:return Object(r.d)(e),[7];case 10:return[2]}}))}))}function v(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(f.a)(e,0)];case 1:if(9===(t=n.sent()).Status||6===t.Status||5===t.Status)Object(r.h)(e);else if(0===t.Status)return[2,{wacUrl:t.WacUrl,bootScriptUrl:t.BootScriptUrl,wopiSrcUrl:t.WopiSrcUrl,accessToken:t.AccessToken,deprecatedTokenAndParameters:t.Token}];return[2,null]}}))}))}Object(a.orchestrator)(r.g,(function(){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:if(!c.a.getWacInfoQueue.length)return[2];if(c.a.activeGetWacInfoOperations.length>=o.i)return[2];e=c.a.getWacInfoQueue[0],Object(r.f)(e),Object(r.c)(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,O(e,!1)];case 2:return t.sent(),[3,4];case 3:return Object(r.d)(e),Object(r.g)(),[7];case 4:return[2]}}))}))}));var h=n(193),j=n(4159),m=n(1701),S=n(6116),w=[/unsubscribealert\.aspx/i];var g=function(e){for(var t=0;t<w.length;t++){if(w[t].test(e))return!1}return!0};Object(a.orchestrator)(m.b,(function(e){var t=e.element,n=e.itemId;if("a"===t.tagName.toLowerCase()){var c=t;if(Object(S.a)(c)){var a=t.getAttribute(o.b);if(Object(j.b)(a)){var i=!0,u=t.getAttribute(o.a)===o.g;g(a)&&(Object(j.c)(a)?Object(r.a)(t,i,u):Object(l.f)("doc-SxS-jsApi-ODB-Links")&&u?Object(r.b)(t,a,n,i,u):Object(r.a)(t,i,u)),I()}}else{a=c.href,i=!1,u=!1;Object(j.b)(a)&&(g(a)&&(Object(j.c)(a)?Object(r.a)(t,i,u):Object(l.f)("doc-SxS-jsApi-ODB-Links")?Object(r.b)(t,a,n,i,u):Object(r.a)(t,i,u)),I())}}}));var P=!1;function I(){P||(P=!0,Object(h.o)("SharePointLinkFound"))}function W(e){var t=c.a.docLinkPreviewInfoMap.get(e),n=!!t;return(!t||t.time+o.h<=Date.now())&&Object(r.j)(e),n}Object(a.orchestrator)(r.j,(function(e){var t=e.url;c.a.getWacInfoQueue.some((function(e){return e===t}))||c.a.activeGetWacInfoOperations.some((function(e){return e===t}))||c.a.suppressedUrls.some((function(e){return e===t}))||Object(b.a)(t)||(Object(r.i)(t),Object(r.g)())})),Object(a.orchestrator)(m.c,(function(e){var t=e.elements;t&&t.forEach((function(e){var t=e[o.e];t&&(e.removeEventListener("click",t),e[o.e]=null);var n=e[o.f];n&&(e.removeEventListener("mouseup",n),e[o.f]=null)}))})),n.d(t,"tryProcessSharePointLink",(function(){return m.b})),n.d(t,"tryUndoProcessSharePointLink",(function(){return m.c})),n.d(t,"docLinkHadPreviewInfo",(function(){return W})),n.d(t,"forceGetWacInfoOperation",(function(){return O})),n.d(t,"getValidDocLinkPreviewInfo",(function(){return b.a}))},3910:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(38),c=n(3911);t.default=function(e,t){return void 0===e.request||e.request.__type||(e.request=c.default(e.request)),r.makeServiceRequest("GetWacInfo",e,t)}},3911:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);t.default=function(e){return r.__assign({__type:"GetWacInfoRequest:#Exchange"},e)}},4094:function(e,t,n){"use strict";var r=n(12),c=n(4),a={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new r.ObservableMap},o=Object(c.createStore)("sharePointDocLinkPreview",a);t.a=o()},4159:function(e,t,n){"use strict";var r=n(193),c=n(199);function a(e,t){var n;try{n=Object(c.parse)(e).hostname}catch(e){return Object(r.o)("isLinkPrefixedWithBaseUrl"),!1}return n===Object(c.parse)(t).hostname&&e!==t}var o=n(86),i=n(37),u=n(44),s=["https://microsoft.sharepoint.com","https://microsoft-my.sharepoint.com","https://microsoft.sharepoint-df.com","https://microsoft-my.sharepoint-df.com"];function f(e){if(!e)return Object(r.o)("isSharePointLinkCalledWithoutUrl"),!1;var t=Object(o.a)();return t?!(!t.SPO_MySiteHostUrl||!a(e,t.SPO_MySiteHostUrl))||(!(!t.SPO_RootSiteUrl||!a(e,t.SPO_RootSiteUrl))||!!Object(i.f)("doc-SharePoint-dogfoodUser")&&s.some((function(t){return a(e,t)}))):(u.d.info("isSharePointLink:bposNavBarData is null"),!1)}function d(e){return!!e&&(e.indexOf("?at=")>0||e.indexOf("&at=")>0)}n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return f})),n.d(t,"c",(function(){return d}))},5467:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(193);function c(e,t,n){Object(r.o)("SharePointLinkClick",{newTabReason:e,isSafeLinkWrapped:t,isSafeLinkVerified:n})}},5468:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var r=n(3606),c=n(4094);function a(e){return o(e).docLinkPreviewInfo||null}function o(e){var t=c.a.docLinkPreviewInfoMap.get(e);return t?t.time+r.h>Date.now()?{docLinkPreviewInfo:t}:{reason:"Expired"}:c.a.getWacInfoQueue.some((function(t){return t===e}))||c.a.activeGetWacInfoOperations.some((function(t){return t===e}))?{reason:"InQueue"}:c.a.suppressedUrls.some((function(t){return t===e}))?{reason:"FileTypeNotSupportedOrSuppressedAfterError"}:{reason:"Unknown"}}},6116:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(3606);function c(e){return e.hasAttribute(r.b)&&e.hasAttribute(r.d)&&e.hasAttribute(r.a)}},7719:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(5467),c=1,a=2;function o(e,t,n){e.button===c?Object(r.a)("MouseMiddleButton",t,n):e.button===a&&Object(r.a)("MouseRightButton",t,n)}},7720:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(193),c=n(452),a=n(3606),o=n(6116),i=n(5467);function u(e,t,n,u){var s,f,d=Date.now(),l=new r.a("ServiceGeneratedLinkClickHandler"),p="CT="+d+"&OR=OWA-"+(e?e.ctrlKey||1===e.button?"NTB":e.shiftKey?"NW":"NT":"NT")+"&CID="+Object(c.a)(),b=e.currentTarget,O=(f=new URL(b.href),["CID","OR","CT"].forEach((function(e){f.searchParams.get(e)&&f.searchParams.delete(e)})),f);if(Object(o.a)(b)){var v=O.href,h=v.indexOf(a.c);if(-1===h)return;var j=encodeURIComponent(btoa(p));s=v.substr(0,h)+"&xdata="+j+a.c}else{var m=O.href.indexOf("?")>=0?"&":"?";s=O.href+m+p}l.end(),window.open(s),e.preventDefault(),Object(i.a)(u||(e.altKey?"AltKey":e.ctrlKey?"CtrlKey":e.metaKey?"MetaKey":e.shiftKey?"ShiftKey":"Default"),t,n)}},857:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function c(e){var t=r(e);return t?t.replace(".",""):null}function a(e){var t;return(null===(t=c(e))||void 0===t?void 0:t.substring(0,4))||""}var o=n(1186),i=n(8);function u(e){var t;return e>=1073741824?(e/=1073741824,t=Object(i.a)(o.b)):e>=1048576?(e/=1048576,t=Object(i.a)(o.d)):e>=1024?(e/=1024,t=Object(i.a)(o.c)):t=Object(i.a)(o.a),Object(i.b)(t,Math.round(e))}function s(e){return t=e||"",(n=d.exec(t))&&n.length>1&&f[n[1].toLowerCase()];var t,n}var f={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},d=/^\s*([^;\s]*)(?:;|\s|$)/;var l=n(35),p=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],b=[".tiff",".tif"];function O(e,t,n){void 0===n&&(n=!0);var c=r(e)||s(t);return!!c&&(p.indexOf(c.toLowerCase())>=0||n&&b.indexOf(c.toLowerCase())>=0&&(Object(l.d)()||Object(l.c)()||Object(l.g)()||Object(l.f)()&&!Object(l.i)()))}var v,h=n(37),j=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function m(e){if(!Object(h.f)("doc-attachment-documentThumbnail"))return!1;var t=r(e);return!!t&&j.indexOf(t.toLowerCase())>=0}function S(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return v.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return v.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return v.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(v||(v={})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return a})),n.d(t,"h",(function(){return u})),n.d(t,"f",(function(){return O})),n.d(t,"g",(function(){return m})),n.d(t,"e",(function(){return S})),n.d(t,"a",(function(){return v}))}}]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();