self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.ActionableMessageMail.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[98],{1137:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(1),r={};function i(e){var t;null===(t=r[e.type])||void 0===t||t.forEach((function(t){return t(e)}))}function o(e){var t;return r[e]=null!==(t=r[e])&&void 0!==t?t:new Map}function s(e,t,n){var r=a.useRef();a.useEffect((function(){return function(e,t,n){var a=o(e);0===a.size&&window.addEventListener(e,i),a.set(t,n)}(e,r,t),function(){return function(e,t){var n=o(e);n.delete(t),0===n.size&&window.removeEventListener(e,i)}(e,r)}}),n)}},12461:function(e){e.exports=JSON.parse('{"a":"Tbc"}')},12462:function(e){e.exports=JSON.parse('{"a":"Ybc","b":"Zbc","c":"_bc","d":"$bc"}')},12463:function(e){e.exports=JSON.parse('{"b":"bcc","a":"ccc","c":"dcc"}')},12464:function(e){e.exports=JSON.parse('{"a":"acc"}')},12465:function(e){e.exports=JSON.parse('{"d":"Ubc","c":"Vbc","a":"Wbc","b":"Xbc"}')},12466:function(e,t,n){var a=n(12467),r=n(73);"string"==typeof a&&(a=[[e.i,a]]);for(var i=0;i<a.length;i++)r.loadStyles(a[i][1],!1);a.locals&&(e.exports=a.locals)},12467:function(e,t,n){(t=e.exports=n(72)(!1)).push([e.i,'._2pRM5MH2wQSL6KJYv7DZjH{width:calc(100% - 25px);position:absolute;height:calc(100% - 64px)}html[dir=ltr] ._2pRM5MH2wQSL6KJYv7DZjH{margin-left:-20px;margin-right:-35px}html[dir=rtl] ._2pRM5MH2wQSL6KJYv7DZjH{margin-right:-20px;margin-left:-35px}._36_sivvBA_3QDLOOHcFq0k{width:100%;height:100%}html[dir] ._36_sivvBA_3QDLOOHcFq0k{border-width:0}._3CW7BF2coKNui2HaKAh3Zw{font-size:21px;font-weight:100;font-weight:300;color:"[theme:neutralPrimary, default:#333333]"}',""]),t.locals={opayFlexPaneContainer:"_2pRM5MH2wQSL6KJYv7DZjH",opayAppIFrameStyle:"_36_sivvBA_3QDLOOHcFq0k",flexPaneHeader:"_3CW7BF2coKNui2HaKAh3Zw"}},12468:function(e,t,n){(t=e.exports=n(72)(!1)).push([e.i,"html[dir] ._3uEvU5UAdRqP1z24N4hRkz{margin-top:12px}html[dir=ltr] ._3uEvU5UAdRqP1z24N4hRkz{margin-left:52px}html[dir=rtl] ._3uEvU5UAdRqP1z24N4hRkz{margin-right:52px}.cmC6MemIKYrJJ77Z_ZD4n{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}._3FcySUHYRo6OeOulzvvAzX{-ms-flex-item-align:center;align-self:center;height:16px;line-height:16px}html[dir] ._3FcySUHYRo6OeOulzvvAzX{margin-top:8px}._3FcySUHYRo6OeOulzvvAzX ._36SOH4LiYsn62sG0PC93OB{font-size:8px}",""]),t.locals={container:"_3uEvU5UAdRqP1z24N4hRkz",cardArea:"cmC6MemIKYrJJ77Z_ZD4n",bodyToggleButton:"_3FcySUHYRo6OeOulzvvAzX",icon:"_36SOH4LiYsn62sG0PC93OB"}},13387:function(e,t,n){"use strict";n.r(t);var a,r=n(4649),i=n(52),o=n(0),s=n(1310),c=function(e){function t(t){var n=e.call(this)||this;return n.preserveBody=t,n}return Object(o.__extends)(t,e),t.prototype.internalPrepareForExecution=function(t){var n=this.body;e.prototype.internalPrepareForExecution.call(this,t),this.preserveBody&&(this.body=n)},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isPrimary=t.isPrimary},t}(s.HttpAction),d=n(12461),u="Action.Http",l="HttpPOST",p="Action.Submit";!function(e){e.None="none",e.ConnnectorMessage="connectorMessage",e.ExplicitMessageCard="explicitMessageCard",e.RecommendationCard="recommendationCard",e.AddInRecommendationCard="addInRecommendationCard",e.CardHighlight="cardHighlight",e.AdaptiveCard="adaptiveCard",e.ListViewExtractedAction="listViewExtractedAction"}(a||(a={}));var f=n(44),g=n(2),b=n(20),C="WAC_Outlook_React";function m(e,t,n,r,i,s){var c,d=0,u=Object(b.a)(),l=u.UserOptions.MailboxTimeZoneOffset;l&&l.length>0&&l[0].OffsetRanges&&l[0].OffsetRanges.length>0&&(d=l[0].OffsetRanges[0].Offset,c=l[0].TimeZoneId);var p=u.SessionSettings.UserCulture,m={clientType:C,eventName:e,culture:p,uiCulture:p,mailboxType:n?"Group":"User",correlationVector:i||Object(f.b)(),clientVersion:Object(g.g)(),externalDirectoryUserGuid:u.SessionSettings.ExternalDirectoryUserGuid,externalDirectoryTenantGuid:u.SessionSettings.ExternalDirectoryTenantGuid,timeZone:{type:"Windows",id:c,offsetInMinutes:d},originator:t.card.originator,providerAccountUniqueId:t.providerAccountUniqueId,messageType:t.isAdaptiveCard?a.AdaptiveCard.toString():a.ExplicitMessageCard.toString(),messageCardExtensionContext:t.messageCardExtensionContext,messageCardContext:t.card.messageCardContext,genericInfo:s};if(r){var h=function(e,t){var n={};e&&(n.senderAddress=e.senderAddress,n.isGroupEscalationMessage=e.isGroupEscalationMessage,t?(n.threadId=e.conversationId,n.conversationId=n.conversationId,n.postId=e.itemId,n.messageId=n.itemId):(n.messageId=e.itemId,n.conversationId=e.conversationId));return n}(r,n);m=Object(o.__assign)(Object(o.__assign)({},m),h)}return m}var h,v,O=n(4);!function(e){e[e.UnResolved=0]="UnResolved",e[e.InProgress=1]="InProgress",e[e.Resolved=2]="Resolved"}(h||(h={})),function(e){e[e.Empty=0]="Empty",e[e.Success=1]="Success",e[e.Error=2]="Error"}(v||(v={}));var y={cache:{data:null,state:v.Empty,time:null},requestState:h.UnResolved},A=Object(O.createStore)("amClientConfigurationStore",y)(),I=function(){var e,t,n=null;return(null===(t=null===(e=A.cache.data)||void 0===e?void 0:e.clientTimeouts)||void 0===t?void 0:t.default)&&(n=A.cache.data.clientTimeouts.default),n},M=n(165),S=n(85),j=n(4656),T=n(7),x=n(8221),k=n(8222),w=n(27),E="InlineAdaptiveCard",_="ActionCardHttpPostActionClicked",D="SingleClickHttpPostActionClicked",R="AutoInvokeActionClicked",P="30d2f5e2-6e6f-43b0-a2bd-c9d87a5cd6fd",N="HttpPOST",L="userid",U="/actions/{0}/messages/{1}/executeAction?culture={2}",F="/actions/{0}/messages/{1}/adaptiveCard/executeAction?culture={2}",H="/actions/{0}/threads/{1}/posts/{2}/executeAction?culture={3}",B="/actions/{0}/threads/{1}/posts/{2}/adaptiveCard/executeAction?culture={3}";function z(e,t,n,a,r){var i=e["@id"]?e["@id"]:e.id,c={"@type":N,name:e.title,target:e.url,body:e.body,"@id":i,hideCardOnInvoke:e.hideCardOnInvoke,isPrimaryAction:!!e.isPrimary&&e.isPrimary};e.headers&&e.headers.length>0&&(c.headers=e.headers);var d=Object(b.a)(),l=[];if(t)for(var p=0;p<t.length;p++){var f=t[p],g=new s.ValidationResults;if(f.internalValidateProperties(g),g.failures.length>0)return Promise.resolve({success:!1,displayMessage:g.failures[0].errors[0].message});if(f){var C=void 0;C=f instanceof s.DateInput?{id:f.id,value:f.value,usertimezone:d.UserOptions.TimeZone}:{id:f.id,value:f.value},l.push(C)}}var h,v={type:u,url:e.url,body:e.body,method:e.method,id:e.id?e.id:P,headers:e.headers},O=d.SessionSettings.UserCulture,y=m(function(e,t){if(t)return R;if(e.parent){var n=e.parent.constructor;return E===n.name?_:D}return D}(e,r),n,a.mailboxInfo.type===S.a.GroupMailbox,a);return y.actionId=i,y.actionType=e.type,n.isAdaptiveCard?h={httpAction:v,inputParameters:l,connectorSenderGuid:n.connectorSenderGuid,SmtpAddressesSerialized:n.smtpAddressesSerialized,adaptiveCardSignature:n.cardSignature,providerAccountUniqueId:n.providerAccountUniqueId,clientTelemetry:y,adaptiveCardHash:n.cardHash,senderAddress:a.senderAddress}:(c=Object(o.__assign)(Object(o.__assign)({},e.originalJsonPayload),c),h={inputParameters:l,connectorSenderGuid:n.connectorSenderGuid,potentialAction:JSON.stringify(c),SmtpAddressesSerialized:n.smtpAddressesSerialized,messageCardSignature:n.cardSignature,providerAccountUniqueId:n.providerAccountUniqueId,clientTelemetry:y,tenantObjectId:d.SessionSettings.ExternalDirectoryTenantGuid,messageCardHash:n.cardHash,senderAddress:a.senderAddress,culture:O,uiCulture:O}),W(function(e,t,n){var a=e.mailboxInfo.type===S.a.UserMailbox?L:e.mailboxInfo.deprecatedMailboxId,r=e.odataItemId,i=e.odataConversationId;switch(e.mailboxInfo.type){case S.a.UserMailbox:return n?Object(T.b)(F,a,r,t):Object(T.b)(U,a,r,t);case S.a.GroupMailbox:case S.a.TeamsMailbox:return n?Object(T.b)(B,a,i,r,t):Object(T.b)(H,a,i,r,t)}}(a,O,n.isAdaptiveCard),JSON.stringify(h),"HttpAction",null,function(e){try{return e.card.messageCardContext.correlationId}catch(e){return""}}(n),r)}var J=function(e){var t=e?6e3:1e4,n=I();return e&&(null==n?void 0:n.AutoInvokedActionTimeoutInMsec)?t=n.AutoInvokedActionTimeoutInMsec:!e&&(null==n?void 0:n.HttpActionTimeoutInMsec)&&(t=n.HttpActionTimeoutInMsec),t};function W(e,t,n,a,r,o){return void 0===o&&(o=!1),new Promise((function(s){var c=a||Object(f.b)(),u={correlationVector:c,cardCorrelationId:r,requestType:n};Object(j.a)().then((function(n){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&s(function(e,t){try{var n=JSON.parse(t),a=!!e&&((r=n.status)&&"completed"===r.toLowerCase());return{success:a,displayMessage:n.displayMessage?n.displayMessage:a?Object(T.a)(k.a):Object(T.a)(x.a),performedAt:n.performedAt,newCardPayload:n.refreshCardSerialized,newCardSignature:n.refreshCardSignature,removeCard:n.removeCard,showOriginalCard:n.showOriginalCard,hideCard:n.hideCard}}catch(e){return{success:!1,displayMessage:Object(T.a)(x.a)}}var r}(200===a.status,a.responseText))},a.ontimeout=function(){s({success:!1,displayMessage:Object(T.a)(d.a)}),Object(M.m)("ActionableMessageConnectorsPostRequestTimeout",void 0,void 0,void 0,u)},a.open("POST",e,!0),a.timeout=J(o),a.setRequestHeader("MS-CV",c),a.setRequestHeader("X-OWA-CANARY",Object(w.a)()),a.setRequestHeader("Authorization","Bearer "+n),a.send(t)})).catch((function(e){i.d.info("Error getting auth token: "+e),s({success:!1,displayMessage:Object(T.a)(x.a)}),Object(M.m)("ActionableMessageConnectorsPostRequestErrorGettingToken",void 0,void 0,e,u)}))}))}var G=n(5);function q(e){var t=Object(G.w)(e.currentCardCheckpoints.cardRenderEnd,e.loadStart),n=Object(G.w)(e.currentCardCheckpoints.cardCreateEnd,e.currentCardCheckpoints.cardCreateStart),a=e.initialCardCheckpoints?Object(G.w)(e.initialCardCheckpoints.cardCreateEnd,e.initialCardCheckpoints.cardCreateStart):0,r=Object(G.w)(e.currentCardCheckpoints.cardRenderEnd,e.currentCardCheckpoints.cardRenderStart),i=e.initialCardCheckpoints?Object(G.w)(e.initialCardCheckpoints.cardRenderEnd,e.initialCardCheckpoints.cardRenderStart):0,o=Object(G.w)(e.autoInvokeActionEnd,e.autoInvokeActionStart),s=Object(G.w)(e.currentCardCheckpoints.themeLoadTotalEnd,e.currentCardCheckpoints.themeLoadTotalStart),c=e.initialCardCheckpoints?Object(G.w)(e.initialCardCheckpoints.themeLoadTotalEnd,e.initialCardCheckpoints.themeLoadTotalStart):0,d=e.currentCardCheckpoints.totalFetchTime,u=e.initialCardCheckpoints?e.initialCardCheckpoints.totalFetchTime:0,l=Object(G.w)(e.currentCardCheckpoints.cardLibraryRenderEnd,e.currentCardCheckpoints.cardLibraryRenderStart),p=e.initialCardCheckpoints?Object(G.w)(e.initialCardCheckpoints.cardLibraryRenderEnd,e.initialCardCheckpoints.cardLibraryRenderStart):0,f=Object(G.w)(e.currentCardCheckpoints.prepareCardEnd,e.currentCardCheckpoints.prepareCardStart),g=e.initialCardCheckpoints?Object(G.w)(e.initialCardCheckpoints.prepareCardEnd,e.initialCardCheckpoints.prepareCardStart):0,b=[];return b.TCRT=t,b.FCRT=r,b.ICRT=i,b.FCPT=n,b.AIT=o,b.ICRT=a,b.FCTT=s,b.ICTT=c,b.FCFT=d,b.ICFT=u,b.FCHT=l,b.ICHT=p,b.FCPT=f,b.ICPT=g,function(e){var t="[";return Object.keys(e).forEach((function(n,a){0!==a&&(t+=", "),t+='"'+n+'": "'+e[n]+'"'})),t+="]"}(b)}var V="/actions/{0}/clientTelemetry/",Y="mailboxId";function Q(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,W(t?Object(T.b)(V,t):Object(T.b)(V,Y),JSON.stringify(e),"Telemetry",e.correlationVector)];case 1:return n.sent(),[2]}}))}))}function Z(e){var t=new c(!0);return t.method="POST",t.body=e.body,t.title=e.name,t.originalJsonPayload=e,e.headers&&e.headers.length>0&&(t.headers=[],e.headers.forEach((function(e){t.headers.push(new s.HttpHeader(e.name,e.value))}))),t.url=e.target,t["@id"]=e["@id"],t.hideCardOnInvoke=e.hideCardOnInvoke,t}var K=n(51),X=n(206);var $=n(14),ee=function(){return!!Object($.b)(window)&&!!Object($.a)(window,"ActionableMessages.ClientConfiguration")},te=function(){return A.cache.state!==v.Empty},ne=function(){var e=Date.now()-A.cache.time;return A.cache.state===v.Success&&e>=432e6||A.cache.state===v.Error&&e>=864e5},ae=Object(O.mutatorAction)("updateRequestState",(function(e){A.requestState=e})),re=function(){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){var e,t,n,a;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,6,,7]),e="/actions/v1.0/"+Object(S.d)()+"/clientConfigs/WAC_Outlook_React?clientVersion="+Object(g.g)()+"&clientColorScheme=default&$expand=providerConfigs",[4,Object(o.__awaiter)(void 0,void 0,void 0,(function(){var e,t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return e=new Headers,[4,Object(j.a)()];case 1:return t=n.sent(),e.set("Authorization",function(e){return"Bearer "+e}(t)),e.set("MS-CV",Object(f.b)()),[2,e]}}))}))];case 1:return t=r.sent(),n=new Request(e,{method:"GET",headers:t}),[4,fetch(n)];case 2:return(a=r.sent()).ok?[4,a.json()]:[3,4];case 3:return[2,r.sent()];case 4:throw a;case 5:return[3,7];case 6:throw r.sent();case 7:return[2]}}))}))},ie=Object(O.mutatorAction)("setClientConfiguration",(function(e){A.cache=e})),oe=function(e,t){return{data:e,state:t,time:Date.now()}},se=Object(O.action)("loadClientConfiguration");Object(O.orchestrator)(se,(function(){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){var e,t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:ae(h.InProgress),e=null,n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,re()];case 2:return t=n.sent(),e=oe(t,v.Success),[3,5];case 3:return n.sent(),e=oe(null,v.Error),[3,5];case 4:return ie(e),function(e){if(Object($.b)(window))try{Object($.d)(window,"ActionableMessages.ClientConfiguration",JSON.stringify(e))}catch(e){i.d.info("[MessageCardDebug] owa-actionable-message-connectors loadClientConfiguration setClientConfigurationInLocalStorage Exception on setItem|JSON.stringify "+e.toString())}}(e),ae(h.Resolved),[7];case 5:return[2]}}))}))}));var ce=se,de=function(){A.requestState!==h.InProgress&&ce()},ue=function(){return ee()?JSON.parse(Object($.a)(window,"ActionableMessages.ClientConfiguration")):null},le=function(){return A.cache.state},pe=function(){return te()?(ne()&&de(),le()===v.Success):ee()?(ie(ue()),ae(h.Resolved),ne()&&de(),le()===v.Success):(de(),!1)},fe=function(){return A.cache},ge=function(){var e,t,n=!1;if(pe()){var a=fe();(null===(t=null===(e=null==a?void 0:a.data)||void 0===e?void 0:e.organizationConfigs)||void 0===t?void 0:t.SmtpActionableMessagesEnabled)&&(n=!0)}return n},be="data:",Ce="blob:";function me(e,t){var n=e.querySelectorAll('img:not([src^="cid:"])');if(n)for(var a=0;a<n.length;a++)0!==n[a].src.indexOf(be)&&0!==n[a].src.indexOf(Ce)&&he(n[a],t.deprecatedMailboxId)}function he(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n;return Object(o.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,Object(j.b)()];case 1:return a.sent(),e.src="/actions/"+t+"/th?u="+encodeURIComponent(e.src),[3,3];case 2:return n=a.sent(),i.d.warn("[fixSrcForExternalImage] Error setting src value. Exception: "+n.message),[3,3];case 3:return[2]}}))}))}var ve="20000101001",Oe=window.location.origin+"/actions/theme";function ye(e){return void 0===e&&(e="default"),Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n,a,r,i,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Object(j.b)()];case 1:t=o.sent(),n=function(e,t){var n={},a=Object(g.g)()?Object(g.g)():ve;return a=a.replace(/[^\d]/g,""),n.method="GET",n.headers=new Headers,n.headers.set("X-ClientType","owa"),n.headers.set("X-ClientVersion","16."+a.substr(0,4)+"."+a.substr(4,4)+"."+a.substr(8)),n.headers.set("X-ClientColorScheme",t),n.headers.set("Authorization","Bearer "+e),n}(t,e),a=void 0,o.label=2;case 2:return o.trys.push([2,7,,8]),[4,fetch(Oe,n)];case 3:return(r=o.sent())&&200==r.status?(i=Ae,[4,r.text()]):[3,5];case 4:return[2,i.apply(void 0,[o.sent()])];case 5:a=r?r.status+"-"+r.statusText:"No response",o.label=6;case 6:return[3,8];case 7:return s=o.sent(),a=s.message,[3,8];case 8:throw a}}))}))}function Ae(e){var t={};try{var n=JSON.parse(e).connectors;Object.keys(n).forEach((function(e){var a={themeConfigUrl:n[e],hostConfig:null,stylesheetUrl:null,isResolved:!1};t[e]=a}))}catch(e){i.d.warn("downloadThemeDefinition: error parsing response: "+e)}return t}var Ie={logTelemetry:function(e){var t,n=e.mailboxInfo,a=e.eventName,r=e.cardDetails,o=e.messageContext,s=e.correlationVector,c=e.actionContext,d=e.perfCheckpoints,u=n.type===S.a.GroupMailbox;if(d)try{t=q(d)}catch(e){i.d.warn("Actionable Message Cards: exception when calculating genericInfo datapoint: "+e.message)}var l=m(a,r,u,o,s,t);return l.connectorSenderGuid=r.connectorSenderGuid,c&&(l.actionContext=c),Object(M.o)("AdaptiveCardLogger-"+a,{CorrelationVector:s}),Q(l,u?n.deprecatedMailboxId:null),i.d.info("[logTelemetry] Log telemetry triggered"),l.correlationVector}},Me={registerActions:function(){s.AdaptiveCard.actionTypeRegistry.unregisterType(p),s.AdaptiveCard.actionTypeRegistry.registerType(u,(function(){return new c(!1)}))},executeAction:function(e,t,n,a,r,o,s){return e instanceof c&&(z(e,n,t,r,s).then((function(e){i.d.info("[ActionableMessageCard] onExecuteAction: executeHttpAction response: "+e),a(e)})),!0)},parseLegacyMessageCardAction:function(e,t){switch(e["@type"]){case"HttpPOST":return Z(e)}return null},processAutoInvokeAction:function(e,t){if(e.type===u||e["@type"]===l){var n=void 0;return t.isAdaptiveCard?((n=new c(!1)).parse(e),n.hideCardOnInvoke=e.hideCardOnInvoke):n=Z(e),n}return null},registerHostCapabilities:function(e){Object(K.f)("rp-actionableMessages-aad-token")&&!Object(X.a)()&&(e.AADAuthentication="*")}},Se="CardLinkInteraction";function je(e,t,n,a){i.d.info("[logAdaptiveCardLinkInteraction] Log event captured for link interaction on an adaptive card");var o=Object(r.d)(n);n.card&&o?Ie.logTelemetry({mailboxInfo:t,cardDetails:n,eventName:Se+"_"+o,messageContext:a}):i.d.warn("[logAdaptiveCardLinkInteraction] Cannot log link interaction - message card context is undefined")}var Te=n(2958),xe=n(8223),ke=Object(O.mutatorAction)("setCardDetailsOnItem",(function(e,t){e.adaptiveCardDetails=t})),we=n(2539),Ee="00000000-0000-0000-0000-000000000000",_e="Highlight_";function De(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n,a,s,c,d,u,l,p;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:try{t=JSON.parse(e)}catch(t){throw new Error("[ActionableMessageCard] parseCardProperty: unable to parse card data: "+e)}return n={connectorSenderGuid:t.ConnectorSenderGuid?t.ConnectorSenderGuid:Ee,smtpAddressesSerialized:t.SmtpAddressesSerialized,providerAccountUniqueId:t.ProviderAccountUniqueId,messageCardExtensionContext:t.MessageCardExtensionContext},a=[],t.AdaptiveCardSerialized?(c=(s=a).push,[4,r.e.import().then((function(e){return e(n,t.AdaptiveCardSerialized,t.AdaptiveCardSignature,!0)}))]):[3,2];case 1:return c.apply(s,[o.sent()]),[3,5];case 2:return t.MessageCardSerialized?(u=(d=a).push,[4,r.e.import().then((function(e){return e(n,t.MessageCardSerialized,t.MessageCardSignature,!1)}))]):[3,4];case 3:return u.apply(d,[o.sent()]),[3,5];case 4:return i.d.info("[ActionableMessageCard] parseCardProperty: No serialized card present"),[2,[]];case 5:return p=(l=a).concat,[4,Re(t,n)];case 6:return[2,p.apply(l,[o.sent()])]}}))}))}function Re(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,a=this;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:return n=[],[4,Promise.all(Object.keys(e).map((function(s){return Object(o.__awaiter)(a,void 0,void 0,(function(){var a,c,d,u;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:if(!e.hasOwnProperty(s)||0!==s.indexOf(_e))return[3,4];a=e[s],o.label=1;case 1:return o.trys.push([1,3,,4]),c=JSON.parse(a),[4,r.e.import().then((function(e){return e(t,c.card,null)}))];case 2:return(d=o.sent()).isContextual=!0,d.key=c.id,d.highlightTerm=c.text,n.push(d),[3,4];case 3:return u=o.sent(),i.d.warn("[ActionableMessageCard] RenderCard: unable to render hightlight card: "+u.message),[3,4];case 4:return[2]}}))}))})))];case 1:return s.sent(),[2,n]}}))}))}function Pe(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,Ne(e)];case 1:return t=n.sent()||[],e.adaptiveCardDetails&&0!==e.adaptiveCardDetails.length?i.d.info("[MessageCardDebug] initCardDetailsOnItem: not replacing existing details"):(i.d.info("[MessageCardDebug] initCardDetailsOnItem: setting card details on item"),ke(e,t)),[2]}}))}))}function Ne(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(o.__generator)(this,(function(a){switch(a.label){case 0:t=null,a.label=1;case 1:return a.trys.push([1,4,,5]),[4,Te.c.import()];case 2:return[4,a.sent()(e.ItemId.Id,xe.c)];case 3:return t=a.sent(),[3,5];case 4:return a.sent(),[3,5];case 5:return t?(n=Object(we.a)(t,null,xe.a))?[4,De(n)]:[3,7]:[3,8];case 6:return[2,a.sent()];case 7:return i.d.info("[loadCardDetailsForItem] extendedProperty could not be retrieved"),[2,null];case 8:return[2,null]}}))}))}function Le(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return e.adaptiveCardDetails?[2,e.adaptiveCardDetails]:[4,Pe(e)];case 1:return t.sent(),[2,e.adaptiveCardDetails]}}))}))}var Ue=n(29),Fe=Object(O.mutatorAction)("SET_SHOW_BODY_WITH_MESSAGE_CARD",(function(e,t){e?e.showBodyWithMessageCard=t:i.d.warn("[setShowBodyWithMessageCard] viewState undefined")})),He=Object(O.action)("showCardLoading",(function(e,t){return{viewState:e,showCardLoading:t}})),Be=(Object(O.mutator)(He,(function(e){e.viewState.showCardLoading=e.showCardLoading})),n(1512)),ze=n(849),Je="cid:",We=/url\("(.*)"\)/g,Ge='url("{0}")',qe='img[src^="cid:"]',Ve="div[style*='background-image: url(\"cid:']";function Ye(e,t,n){var a=e.querySelectorAll(qe);if(a)for(var r=0;r<a.length;r++)Qe(a[r],t,n);var i=e.querySelectorAll(Ve);if(i)for(r=0;r<i.length;r++)Ze(i[r],t,n)}function Qe(e,t,n){if(e.src&&0===e.src.indexOf(Je)){var a=Ke(e.src,t,n);a&&(e.src=a)}}function Ze(e,t,n){var a=e.style.backgroundImage,r=We.exec(a);if(r&&r.length>1&&r[1]){var i=Ke(r[1],t,n);i&&(e.style.backgroundImage=Object(T.b)(Ge,i))}}function Ke(e,t,n){if(!t.Attachments)return null;for(var a,r=Xe(e.substring(Je.length)),s=0;s<t.Attachments.length;s++){var c=t.Attachments[s];if(r===Xe(c.Name)||r===Xe(c.ContentId)){a=c.AttachmentId;break}}if(!a)return i.d.error("fixSrcForImage: attachment id not found for cid: "+r),null;var d=Object(Be.b)(Object(o.__assign)(Object(o.__assign)({},a),{mailboxInfo:n}),1);return d||(i.d.error("fixSrcForImage: could not create attachment url for image with cid: "+r+" and attachment id: "+a),null)}function Xe(e){if(Object(ze.f)(e)){var t=Object(ze.b)(e);return e.substring(0,e.length-t.length)}return e}var $e=n(6734),et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.__extends)(t,e),t.prototype.getJsonTypeName=function(){return"DisplayAppointmentForm"},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.itemId=t.itemId,this.isPrimary=t.isPrimary},t}(s.Action),tt="Action.InvokeAddInCommand",nt="Action.DisplayReplyAllForm",at="Action.DisplayAppointmentForm",rt="Action.DisplayMessageForm",it="Action.StartBotConversation",ot=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.__extends)(t,e),t.prototype.getJsonTypeName=function(){return rt},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.itemId=t.itemId,this.isPrimary=t.isPrimary},t}(s.Action),st=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(o.__extends)(t,e),t.prototype.getJsonTypeName=function(){return"DisplayReplyAllForm"},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isPrimary=t.isPrimary},t}(s.Action),ct=function(e){function t(){var t=e.call(this)||this;return t.addinId="",t.desktopCommandId="",t.initializationContext="",t}return Object(o.__extends)(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isPrimary=t.isPrimary,this.addinId=t.addInId?t.addInId:t.addinid,this.desktopCommandId=t.desktopCommandId?t.desktopCommandId:t.desktopcommandid,this.initializationContext=t.initializationContext?JSON.stringify(t.initializationContext):JSON.stringify(t.initializationcontext)},t.prototype.getJsonTypeName=function(){return tt},t}(s.Action),dt=function(e){function t(){var t=e.call(this)||this;return t.botId="",t.initialMessage="",t.botName="",t}return Object(o.__extends)(t,e),t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isPrimary=t.isPrimary,this.botId=t.botId,this.botName=t.botName,this.initialMessage=t.initialMessage},t.prototype.getJsonTypeName=function(){return it},t}(s.Action),ut=n(910),lt=n(954),pt=n(8205),ft=n(1029),gt=n(2854),bt=n(5539),Ct=n(1380),mt="MessageCardInvokeAddinCommandClicked",ht="DisplayAppointmentFormClicked",vt="DisplayMessageFormClicked",Ot="actionContext";var yt={registerActions:function(){s.AdaptiveCard.actionTypeRegistry.registerType(tt,(function(){return new ct})),s.AdaptiveCard.actionTypeRegistry.registerType(nt,(function(){return new st})),s.AdaptiveCard.actionTypeRegistry.registerType(at,(function(){return new et})),s.AdaptiveCard.actionTypeRegistry.registerType(rt,(function(){return new ot})),Object(K.f)("mc-botConversation")&&s.AdaptiveCard.actionTypeRegistry.registerType(it,(function(){return new dt}))},executeAction:function(e,t,n,a,r,o,c){var d={mailboxInfo:r.mailboxInfo,cardDetails:t,messageContext:r,actionContext:e[Ot],eventName:void 0};if(e instanceof st){i.d.info("[ActionableMessageCard] onExecuteAction: reply all with: "+e.title);var u=Ct.HtmlSanitizer.sanitizeHtml(e.title);ft.t.importAndExecute({referenceItemId:{Id:r.itemId,mailboxInfo:r.mailboxInfo},isReplyAll:!0,useFullCompose:!1,actionSource:"Link",instrumentationContexts:null,conversationId:r.conversationId,body:u})}else if(e instanceof et){i.d.info("[ActionableMessageCard] onExecuteAction: display appointment form for itemId: "+e.itemId),d.eventName=ht,o.logTelemetry(d);var l="/calendar/item/"+encodeURIComponent(e.itemId);window.open(l,"_blank")}else if(e instanceof ot)i.d.info("[AdaptiveCard] DisplayMessageFormAction executed"),d.eventName=vt,o.logTelemetry(d),Object(gt.a)(e.itemId);else if(e instanceof ct){i.d.info("[AdaptiveCard] InvokeAddinCommandAction executed"),d.eventName=mt,o.logTelemetry(d);var p=e,f=Object(ut.o)(r.itemId);ut.w.import().then((function(e){e(f,p.addinId.toLowerCase(),p.desktopCommandId,lt.a.MessageRead,p.initializationContext)}))}else if(e instanceof dt){var g=e,b=g.botId,C=g.botName,m=function(e){if(null==e?void 0:e.$data)return e.$data;return}(t.card);i.d.info("[ActionableMessageCard] StartBotConversation executed with message: "+b),pt.a.import().then((function(e){return e(r.mailboxInfo,{friendlyBotName:C,botId:b,botData:m,connectorSenderGuid:t.connectorSenderGuid,smtpAddressSerialized:t.smtpAddressesSerialized},"help")})),o.logTelemetry(d)}else{if(!(e instanceof s.OpenUrlAction))return!1;if("mailto:"===(l=new URL(e.url)).protocol.toLowerCase()){var h=Object(bt.a)(l.href).composeInitProps;ft.r.importAndExecute(h,2)}}return!0},parseLegacyMessageCardAction:function(e,t){switch(e["@type"].toLowerCase()){case"displayreplyallform":return n=e,(a=new st).title=n.name,a.htmlBody=n.htmlBody,a;case"invokeaddincommand":return function(e){var t=new ct;return t.title=e.name,t.addinId=e.addInId,t.desktopCommandId=e.desktopCommandId,t.initializationContext=JSON.stringify(e.initializationContext),t}(e)}var n,a;return null},processAutoInvokeAction:function(e,t){if(Object(K.f)("mc-botConversation")&&e.type===it){var n=new dt;return n.parse(e),n}return null},registerHostCapabilities:null},At=n(513),It=n(12462),Mt=n(12463),St=n(12464),jt=n(247);var Tt,xt=n(1),kt=n(12465),wt=n(3965),Et=n(58),_t=n(1008),Dt=n(2015),Rt="ActionableMessageTeachingUI",Pt=""+Rt,Nt={CLICK:Pt+"_BtnClicked",GOTITCUSTOM:Pt+"_GotItClicked",LEARN:Pt+"_LearnMoreClicked",TRIGGERED:Pt+"_Triggered",DISMISSED:{BTNSCT:Pt+"_DismisByAction",UNMNT:Pt+"_DismissByUnmount"},SCOPE:{MOUNTED:Pt+"_Mounted",UNMNTED:Pt+"_Unmounted"},DISABLED:Pt+"_FlightDisabled",RENDERED:Pt+"_Rendered"},Lt={Transaction:"https://support.office.com/en-us/article/pay-bills-and-invoices-in-outlook-using-microsoft-pay-1196e7e6-c096-44f1-a18a-9df3af832a48"};function Ut(e,t){Object(M.o)(e,t),Q(Object(o.__assign)({eventName:e,clientVersion:t.owaVersion,clientType:"WAC_Outlook_React"},t),null)}function Ft(e){if(e)try{i.d.info("[ActionableMessageTeachingUI] Corelation telemetry trace function called"),function(e){Tt=Tt||{correlationVector:"",adaptiveCardCorrelationId:"",owaVersion:"",messageId:"",lightningAction:"",tuiType:""},Object(Dt.a)(Tt,e)}(e)}catch(e){i.d.warn("[ActionableMessageTeachingUI] Failed complete the logging of the telemetry - "+e.message)}return Tt&&(Tt.correlationVector=Tt?Object(f.b)():void 0),Tt}var Ht=Object(_t.c)(Object(Ue.a)((function(e){e=Object(o.__assign)({hasSmallIcon:!0,hasSmallHeadline:!0,hasCloseIcon:!0,isWide:!0},e);var t=Object(o.__read)(xt.useState(!0),2),n=t[0],a=t[1];xt.useEffect((function(){return i.d.info("[ActionableMessageTeachingUI:TeachingBubble] Teaching Bubble DidMount"),Ut("TeachingBubble_"+Nt.SCOPE.MOUNTED,Ft()),function(){i.d.info("[ActionableMessageTeachingUI:TeachingBubble] Teaching Bubble WillUnmountMount"),Ut("TeachingBubble_"+Nt.SCOPE.UNMNTED,Ft())}}),[]);var r=function(t){void 0===t&&(t="Primary"),"Secondary"==t?(i.d.info("[ActionableMessageTeachingUI:TeachingBubble] teacing bubble dismissed by user interaction"),Ut("TeachingBubble_"+Nt.CLICK,Ft({lightningAction:t}))):(i.d.info("[ActionableMessageTeachingUI:TeachingBubble] teaching bubble passively dismissed"),Ut("TeachingBubble_"+Nt.DISMISSED.UNMNT,Ft({lightningAction:t}))),Object(_t.d)(e.lid,t),a(!1)};return n&&(i.d.info("[ActionableMessageTeachingUI:TeachingBubble] Using TeachingBubble for ActionableMessageTeachingUI"),Ut("TeachingBubble_"+Nt.RENDERED,Ft())),n&&xt.createElement(wt.a,Object(o.__assign)({calloutProps:{beakWidth:15,directionalHint:Et.DirectionalHint.leftCenter,minPagePadding:50},targetElement:e.target(),primaryButtonProps:Object(o.__assign)(Object(o.__assign)({},e.gotItBtn),{onClick:function(){Ut("TeachingBubble_"+Nt.GOTITCUSTOM,Ft({lightningAction:"Secondary"})),r("Secondary")}}),secondaryButtonProps:Object(o.__assign)(Object(o.__assign)({},e.learnMoreBtn),{onClick:function(){Ut("TeachingBubble_"+Nt.LEARN,Ft({lightningAction:"Secondary"})),window.open(e.learnMoreBtnUri,"_blank"),r("Secondary")}}),onDismiss:function(){return e.onClose||r("Primary")}},e,{target:void 0}),e.bodyText)}))),Bt=n(2023),zt=(n(197),Object(Ue.a)((function(e){xt.useEffect((function(){var t;t={adaptiveCardCorrelationId:e.acCorrelationId,messageId:e.messageId,tuiType:e.actionType},Pt=Rt+"_",Ft({adaptiveCardCorrelationId:t.adaptiveCardCorrelationId,messageId:t.messageId,owaVersion:Object(g.g)(),lightningAction:"",tuiType:t.tuiType})}),[]);var t;return"Transaction"==e.actionType&&xt.createElement(Ht,{target:e.target,when:function(e){Ut(Nt.TRIGGERED,Ft()),e()},gotItBtn:(t="TeachingBubble",{buttonType:Bt.a.primary,children:Object(T.a)(kt.a),onClick:t}),learnMoreBtn:Jt("TeachingBubble"),learnMoreBtnUri:Lt[e.actionType]||void 0,headline:Object(T.a)(kt.d),bodyText:Object(T.a)(kt.c),hasSmallHeadline:!0,lid:_t.b.ActionableMessageTeachingUiTeachingBubblePolicy})})));function Jt(e){return{buttonType:Bt.a.normal,children:Object(T.a)(kt.b),onClick:e}}var Wt=n(5429),Gt=n(9029),qt=(Object(O.mutator)(Gt.a,(function(e){var t=Wt.a.cards.get(e.cardId);t&&(t.autoInvokeActionAlreadyRan=e.autoInvokeActionAlreadyRan)})),n(77)),Vt={XeroOpay:"Transaction"};function Yt(e){var t,n,a,r=void 0;if(i.d.info("[getCardTypeFromCardDetails] Fetching the card type"),null===(t=e.card)||void 0===t?void 0:t.messageCardContext){var o=e.card.messageCardContext;n=o.oamAppName,(a=Vt[n])||i.d.warn("[getCardType] Unable to fetch cardType for OamAppName "+n),r=a||"Unknown"}else i.d.warn("[getCardTypeFromCardDetails] Cannot extract the context of an invalid CardDetails object");return r}var Qt=n(9030);var Zt=function(){function e(e,t,n,a){this.perfCheckpoints={currentCardCheckpoints:{},initialCardCheckpoints:{}},this.telemetryProvider=e,this.mailboxInfo=t,this.messageContext=n,this.perfData=a}return e.prototype.stampPerfCheckpoint=function(e,t){!function(e,t,n){var a=n||Object(G.Qb)();switch(t){case Qt.a.LoadStart:e.loadStart=a;break;case Qt.a.AutoInvokeActionStart:e.autoInvokeActionStart=a;break;case Qt.a.AutoInvokeActionEnd:e.autoInvokeActionEnd=a;break;case Qt.a.CardRenderStart:e.currentCardCheckpoints.cardRenderStart=a;break;case Qt.a.CardRenderEnd:e.currentCardCheckpoints.cardRenderEnd=a;break;case Qt.a.ThemeLoadTotalStart:e.currentCardCheckpoints.themeLoadTotalStart=a;break;case Qt.a.ThemeLoadTotalEnd:e.currentCardCheckpoints.themeLoadTotalEnd=a;break;case Qt.a.ThemeDefinitionsLoadStart:e.currentCardCheckpoints.themeDefinitionsLoadStart=a;break;case Qt.a.ThemeDefinitionsLoadEnd:e.currentCardCheckpoints.themeDefinitionsLoadEnd=a;break;case Qt.a.ThemeResolveStart:e.currentCardCheckpoints.themeResolveStart=a;break;case Qt.a.ThemeResolveEnd:e.currentCardCheckpoints.themeResolveEnd=a;break;case Qt.a.CardCreateStart:e.currentCardCheckpoints.cardCreateStart=a;break;case Qt.a.CardCreateEnd:e.currentCardCheckpoints.cardCreateEnd=a;break;case Qt.a.CardLibraryRenderStart:e.currentCardCheckpoints.cardLibraryRenderStart=a;break;case Qt.a.CardLibraryRenderEnd:e.currentCardCheckpoints.cardLibraryRenderEnd=a;break;case Qt.a.PrepareCardStart:e.currentCardCheckpoints.prepareCardStart=a;break;case Qt.a.PrepareCardEnd:e.currentCardCheckpoints.prepareCardEnd=a;break;default:i.d.info("Actionable Message Card: markPerfCheckpointMutator called with unespected PerfMarker")}}(this.perfCheckpoints,e,t)},e.prototype.logTelemetryProvider=function(e,t,n,a){var r=this.getTelemetryDetailsForEvent(e,t,n,a);this.telemetryProvider.logTelemetry(r)},e.prototype.setTotalFetchTimeForCard=function(){this.perfCheckpoints&&this.perfCheckpoints.currentCardCheckpoints&&(this.perfCheckpoints.currentCardCheckpoints.totalFetchTime=Object(G.w)(this.perfData.fetchEndTime,this.perfData.fetchStartTime))},e.prototype.getTelemetryDetailsForEvent=function(e,t,n,a){return{mailboxInfo:this.mailboxInfo,messageContext:this.messageContext,cardDetails:e,eventName:t,actionContext:n,correlationVector:a,perfCheckpoints:this.perfCheckpoints}},e.prototype.updatePerfCheckpointsBeforeAutoInvoke=function(){this.perfCheckpoints&&(this.perfCheckpoints.initialCardCheckpoints=this.perfCheckpoints.currentCardCheckpoints,this.perfCheckpoints.currentCardCheckpoints={})},e}();n(448);var Kt=new qt.c((function(){return Promise.all([n.e(5),n.e(8),n.e(15),n.e(23),n.e(97)]).then(n.bind(null,13414))})),Xt=Object(qt.d)(Kt,(function(e){return e.ActionableMessageCardWrapper})),$t=(new qt.b(Kt,(function(e){return e.parseCardFromStringOrObject})),"TransactionCardDisabled"),en="messageCardContext";function tn(e,t,n,a,i){var o=e.card;if(o&&o.hasOwnProperty(en)){if(!o.messageCardContext)return!1;var s=Object(r.d)(e)===r.b.XeroOpay&&n;return s&&i.logTelemetry({mailboxInfo:t,messageContext:a,eventName:$t,cardDetails:e}),s}return!1}var nn="Action.Transaction",an=n(1231),rn=n(112),on=n(12466),sn={PPE:"https://interactive-ppe.outlook.com/ux/app",PROD:"https://interactive.outlook.com/ux/app",DEV:"https://opay-dev-wc-svc.cloudapp.net/ux/app"},cn=function(e){function t(){var t=e.call(this)||this;return t.environment="prod",t.triggerContext=null,t.intent="",t.merchantId="",t.displayId="",t}return Object(o.__extends)(t,e),t.prototype.getJsonTypeName=function(){return nn},t.prototype.parse=function(t){e.prototype.parse.call(this,t),this.isPrimary=t.isPrimary,t.initializationContext?(this.intent=t.initializationContext.intent,this.merchantId=t.initializationContext.merchantId,this.displayId=t.initializationContext.displayId,this.productContext=t.initializationContext.productContext,this.environment=t.initializationContext.environment):(this.intent=t.intent,this.merchantId=t.merchantId,this.displayId=t.displayId,this.productContext=t.productContext,this.environment=t.environment),this.triggerContext={MerchantId:this.merchantId,DisplayId:this.displayId,CorrelationId:Object(f.b)(),Culture:Object(b.a)().SessionSettings.UserCulture,Market:Object(an.g)(),Environment:this.environment},rn.set("DefaultAnchorMailbox",rn.get("DefaultAnchorMailbox"),{path:"/actions/"}),Object(K.f)("ring-dogfood")&&rn.set("DefaultAnchorMailbox",rn.get("DefaultAnchorMailbox"),{path:"/opay/"})},t.prototype.execute=function(){e.prototype.execute.call(this),this.triggerContext.CorrelationId=Object(f.b)()},t.prototype.getIFrameElement=function(){var e=Object(K.f)("rp-opay-modelb-endpoint")?window.location.origin+"/opay":this.getSvcEndpoint(),t=encodeURIComponent(JSON.stringify(this.productContext)),n=e+"/?triggerContext="+encodeURIComponent(JSON.stringify(this.triggerContext))+"&productContext="+t;return xt.createElement("div",{className:on.opayFlexPaneContainer},xt.createElement("iframe",{id:"opay_iframe",className:on.opayAppIFrameStyle,src:n}))},t.prototype.getSvcEndpoint=function(){return this.environment?0===this.environment.indexOf("dev")?sn.DEV:"ppe"===this.environment.toLowerCase()?sn.PPE:sn.PROD:sn.PROD},t}(s.Action),dn={shouldShowModalFlexPane:!1,modalFlexPaneContent:void 0},un=Object(O.createStore)("OPayPanel",dn)(),ln=Object(O.mutatorAction)("SHOW_OPAY_PANEL",(function(e){un.shouldShowModalFlexPane=!0,un.modalFlexPaneContent=e})),pn="TransactionActionEvent",fn="actionContext";var gn={registerActions:function(){s.AdaptiveCard.actionTypeRegistry.registerType(nn,(function(){return new cn}))},executeAction:function(e,t,n,a,r,o,s){if(!(e instanceof cn))return!1;i.d.info("[AdaptiveCard] Transaction executed");var c=e;return o.logTelemetry({mailboxInfo:r.mailboxInfo,cardDetails:t,eventName:pn,actionContext:e[fn],messageContext:r,correlationVector:c.triggerContext.CorrelationId}),ln(c.getIFrameElement()),!0},parseLegacyMessageCardAction:function(e,t){switch(e["@type"]){case"Transaction":return n=e,(a=new cn).parse(n),a.title=n.name,a}var n,a;return null},registerHostCapabilities:function(e){e.Transaction="*",e["Transaction.MSA"]="*"}},bn=n(2165),Cn=n(800),mn=n(179),hn=n(1137),vn=Object(O.mutatorAction)("HIDE_OPAY_PANEL",(function(){un.shouldShowModalFlexPane=!1,un.modalFlexPaneContent=void 0})),On=Object(Ue.a)((function(e){return Object(hn.a)("message",(function(t){var n=t.origin.toLowerCase();if(Object.keys(sn).some((function(e){return 0!==sn[e].indexOf(n)}))){var a=null;try{a=JSON.parse(t.data)}catch(e){i.d.warn("Unable to parse post message data: "+t.data)}if(a){var r=a.action;if(r)switch(r){case"close":vn();break;case"token":Object(j.a)().then((function(t){var a=document.querySelector("#opay_iframe");a&&a.contentWindow.postMessage(JSON.stringify({action:"token",token:t,messageContext:{messageId:e.odataItemId,smtpAddressesSerialized:e.smtpAddressesSerialized},result:"Success"}),n)})).catch((function(){window.postMessage(JSON.stringify({action:"token",result:"Failed"}),n)}))}}}})),xt.createElement(Cn.a,{key:"modalFlexPane",onDismiss:function(){vn()},isOpen:un.shouldShowModalFlexPane,type:mn.a.smallFixedFar,closeButtonAriaLabel:Object(T.a)(bn.a)},un.modalFlexPaneContent)})),yn=n(9031),An=Object(Ue.a)((function(e){var t=this;xt.useEffect((function(){return i.d.info("[MessageCardDebug] ActionableMessageMailWrapper mount"),function(){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper unmount")}}),[]),xt.useEffect((function(){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper update"),g()}));var n=xt.useRef(Object($e.a)(e.item)),a=xt.useRef({loadStartTime:Object(G.Qb)()}),r=xt.useRef([]),s=xt.useRef(),c=Object(o.__read)(xt.useState(!1),2),d=c[0],u=c[1],l=Object(o.__read)(xt.useState(null),2),p=l[0],f=l[1],g=function(){return Object(o.__awaiter)(t,void 0,void 0,(function(){var t,n,r,c,d,u,l,p;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return s.current?(i.d.info("[MessageCardDebug] ActionableMessageMailWrapper getCardProperties fetch already in process. Aborting this attempt"),[2]):(t=e.item,a.current.fetchStartTime=Object(G.Qb)(),n=t.adaptiveCardDetails,[4,Object(At.a)()]);case 1:if(r=o.sent(),c=r.SmtpActionableMessagesEnabled,(null==n?void 0:n[0])&&c)return i.d.info("[MessageCardDebug] ActionableMessageMailWrapper getCardProperties already had cardDetails on the item. cardId: "+n[0].cardId),a.current.fetchEndTime=Object(G.Qb)(),[2];d=new M.a("MCActionableCardGetProperty"),o.label=2;case 2:return o.trys.push([2,4,,5]),s.current=!0,i.d.info("[MessageCardDebug] ActionableMessageMailWrapper getCardProperties fetching cardDetails from the server"),[4,Le(t)];case 3:return(u=o.sent())&&u.length>0&&c?(d.end(),a.current.fetchEndTime=Object(G.Qb)(),i.d.info("[MessageCardDebug] ActionableMessageMailWrapper getCardProperties got card details from the server. cardId: "+u[0].cardId),ke(t,u),s.current=!1):(l=c?"getCardProperties error getting card details from the server":"smtp Actionable Messages is disabled for org config",i.d.info("[MessageCardDebug] ActionableMessageMailWrapper "+l),Fe(e.viewState,!0),He(e.viewState,!1),d.endWithError("ServerError")),[3,5];case 4:return p=o.sent(),i.d.info("[MessageCardDebug] ActionableMessageMailWrapper getCardProperties error getting card details from the server"),i.d.warn("[ActionableMessageMailWrapper] ActionableMessageMailWrapper getCardProperties: exception during getCardDetails: "+p.message),Fe(e.viewState,!0),He(e.viewState,!1),d.endWithError("ClientError"),s.current=!1,[3,5];case 5:return[2]}}))}))},b=function(e){return e.filter((function(e){return!e.isContextual}))},C=function(t){var o=b(t),s={onUndo:function(){return t=e.darkModeContentHandler,n=e.undoDarkMode,void(t&&n&&(i.d.info("ActionableMessageMailWrapper: applyDarkModeHandlerToCardElement: undoing dark mode"),t.undoHandler(r.current),r.current=[]));var t,n},onApply:function(t){return function(t){var n=e.undoDarkMode,a=e.darkModeContentHandler;if(t&&a&&!n)if(i.d.info("ActionableMessageMailWrapper: applyDarkModeHandlerToCardElement: applying dark mode to card elements"),a.cssSelector){a.handler(t),r.current.push(t);var o=t.querySelectorAll(a.cssSelector);if(o)for(var s=0;s<o.length;s++){var c=o.item(s);a.handler(c),r.current.push(c)}}else i.d.info("ActionableMessageCard: applyDarkModeHandlerToCardElement: no cssSelector specified by DarkMode handler")}(t)}},c=new Zt(Ie,e.item.MailboxInfo,n.current,a.current);return i.d.info("[MessageCardDebug] ActionableMessageMailWrapper renderCardFromDetails. cardId: "+o[0].cardId),o&&1===o.length?xt.createElement("div",{className:yn.container},xt.createElement(Xt,{key:o[0].cardId,cardDetails:o[0],showMessageBodyCallback:m,contentHandlerUndoMode:e.undoDarkMode,actionProviders:[yt,Me,gn],adjustCardElementBeforeRenderCallback:O,onCardRendered:y,downloadThemeCallback:ye,onCardDetailsUpdated:h,actionableMessageContentHandler:s,actionableMessageCardStrings:{cardDefinitionsStrings:{format:T.b,actionInProgressMessage:Object(T.a)(It.a),defaultPlaceholderTextInput:Object(T.a)(It.b),warningMessageForInvalidInput:Object(T.a)(It.c),warningMessageForMissingRequiredInput:Object(T.a)(It.d),warningMessageForInputNumberNotNumeric:Object(T.a)(Mt.c),warningMessageForInputNumberLessThanMax:Object(T.a)(Mt.a),warningMessageForInputNumberMoreThanMin:Object(T.a)(Mt.b),warningMessageForRequiredField:Object(T.a)(St.a)},dateStrings:Object(jt.a)()},telemetryHandler:c})):(i.d.info("Did not find expected number of cards on the message"),m(!0),xt.createElement("div",null))},m=function(t){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper setShowMessageBody: "+t),Fe(e.viewState,t),t&&He(e.viewState,!1)},h=function(t){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper updateCardOnItem"),ke(e.item,t)},v=function(){var t=e.item.adaptiveCardDetails;if(t&&t.length>0){var n=t[0].card.messageCardContext;return n?{acCorrelationId:n.correlationId,actionType:Yt(t[0]),messageId:e.item.ItemId.Id,target:function(){return p}}:{acCorrelationId:"",actionType:void 0,messageId:null,target:function(){return p}}}return null},O=function(t){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper fixInlineImages"),me(t,e.item.MailboxInfo),Ye(t,e.item,e.item.MailboxInfo)},y=function(t){i.d.info("[MessageCardDebug] ActionableMessageMailWrapper  onCardRendered. Updating loading state"),p!==t&&(u(!0),f(t)),e.viewState.showCardLoading&&He(e.viewState,!1)},A=function(e){return(null==e?void 0:e.actionType)&&null!=e.target?(i.d.info("[ActionableMessageCard] TeachingUI triggered"),xt.createElement(zt,Object(o.__assign)({},e))):null},I=e.item.adaptiveCardDetails;return i.d.info("[MessageCardDebug] ActionableMessageMailWrapper render. itemId: "+e.item.ItemId.Id+". CardDetails: "+((null==I?void 0:I[0])?I[0].cardId:"undefined")),I&&I.length>0&&0===function(t){var a=b(t);return 0!=(a=a.filter((function(t){return tn(t,e.item.MailboxInfo,Object(K.f)("rp-acDisableTransactionCard"),n.current,Ie)}))).length&&(Fe(e.viewState,!0),He(e.viewState,!1)),a}(I).length?function(e){return xt.createElement(xt.Fragment,null,xt.createElement("div",{className:yn.cardArea},C(e)),xt.createElement(On,{odataItemId:n.current.odataItemId,smtpAddressesSerialized:e[0].smtpAddressesSerialized}),d&&A(e?v():null))}(I):xt.createElement("div",null)})),In=n(1651),Mn="62242e1d-c39a-4f8a-a66e-1d39c0a336b0";var Sn=n(9031),jn=Object(Ue.a)((function(e){var t=this;xt.useEffect((function(){return i.d.info("[MessageCardDebug] ActionableMessageContent mount"),function(){i.d.info("[MessageCardDebug] ActionableMessageContent unmount")}}),[]),xt.useEffect((function(){i.d.info("[MessageCardDebug] ActionableMessageContent update"),v()})),xt.useEffect((function(){return l.current=setTimeout((function(){i.d.info("[MessageCardDebug] ActionableMessageContent card load timed out"),Object(M.o)("actionableMessageContentLoadTimeout"),p.current=!0,k(!0)}),4e3),function(){return clearTimeout(l.current)}}),[]);var n=xt.useRef(Object($e.a)(e.item)),a=xt.useRef(Object(G.Qb)()),s=xt.useRef(),c=xt.useRef(),d=xt.useRef([]),u=xt.useRef(),l=xt.useRef(),p=xt.useRef(),f=Object(o.__read)(xt.useState(!1),2),g=f[0],b=f[1],C=Object(o.__read)(xt.useState(null),2),m=C[0],h=C[1],v=function(){return Object(o.__awaiter)(t,void 0,void 0,(function(){var t,n,a,r,d,l,p,f;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return u.current?(i.d.info("[MessageCardDebug] ActionableMessageContent getCardProperties fetch already in process. Aborting this attempt"),[2]):(t=e.item,s.current=Object(G.Qb)(),n=t.adaptiveCardDetails,[4,Object(At.a)()]);case 1:if(a=o.sent(),r=a.SmtpActionableMessagesEnabled,(null==n?void 0:n[0])&&r)return i.d.info("[MessageCardDebug] ActionableMessageContent getCardProperties already had cardDetails on the item. cardId: "+n[0].cardId),c.current=Object(G.Qb)(),[2];d=new M.a("MCActionableCardGetProperty"),o.label=2;case 2:return o.trys.push([2,4,,5]),u.current=!0,i.d.info("[MessageCardDebug] ActionableMessageContent getCardProperties fetching cardDetails from the server"),[4,Le(t)];case 3:return(l=o.sent())&&l.length>0&&r?(d.end(),c.current=Object(G.Qb)(),i.d.info("[MessageCardDebug] ActionableMessageContent getCardProperties got card details from the server. cardId: "+l[0].cardId),ke(t,l),u.current=!1):(p=r?"getCardProperties error getting card details from the server":"smtp Actionable Messages is disabled for org config",i.d.info("[MessageCardDebug] ActionableMessageContent "+p),k(!0),d.endWithError("ServerError")),[3,5];case 4:return f=o.sent(),i.d.info("[MessageCardDebug] ActionableMessageContent getCardProperties error getting card details from the server"),i.d.warn("[ActionableMessageContent] ActionableMessageContent getCardProperties: exception during getCardDetails: "+f.message),k(!0),d.endWithError("ClientError"),u.current=!1,[3,5];case 5:return[2]}}))}))},O=function(e){return e.filter((function(e){return!e.isContextual}))},y=function(t){var o=O(t),u={onUndo:function(){return t=e.darkModeContentHandler,n=e.undoDarkMode,void(t&&n&&(i.d.info("ActionableMessageContent: applyDarkModeHandlerToCardElement: undoing dark mode"),t.undoHandler(d.current),d.current=[]));var t,n},onApply:function(t){return function(t){var n=e.undoDarkMode,a=e.darkModeContentHandler;if(t&&a&&!n)if(i.d.info("ActionableMessageCard: applyDarkModeHandlerToCardElement: applying dark mode to card elements"),a.cssSelector){a.handler(t),d.current.push(t);var r=t.querySelectorAll(a.cssSelector);if(r)for(var o=0;o<r.length;o++){var s=r.item(o);a.handler(s),d.current.push(s)}}else i.d.info("ActionableMessageCard: applyDarkModeHandlerToCardElement: no cssSelector specified by DarkMode handler")}(t)}};return o&&1===o.length?(i.d.info("[MessageCardDebug] ActionableMessageContent renderCardFromDetails. cardId: "+o[0].cardId),xt.createElement("div",{className:Sn.container},xt.createElement(r.a,{key:o[0].cardId,cardDetails:o[0],mailboxInfo:e.item.MailboxInfo,messageContext:n.current,showMessageBodyCallback:A,contentHandlerUndoMode:e.undoDarkMode,actionProviders:[yt,Me,gn],telemetryProvider:Ie,adjustCardElementBeforeRenderCallback:j,onCardRendered:T,downloadThemeCallback:ye,onCardDetailsUpdated:I,perfData:{loadStartTime:a.current,fetchStartTime:s.current,fetchEndTime:c.current},actionableMessageContentHandler:u}))):(i.d.info("Did not find expected number of cards on the message"),A(!0),xt.createElement("div",null))},A=function(t){i.d.info("[MessageCardDebug] ActionableMessageContent setShowMessageBody: "+t),Fe(e.viewState,t),t&&He(e.viewState,!1),k(t)},I=function(t){i.d.info("[MessageCardDebug] ActionableMessageContent updateCardOnItem"),ke(e.item,t)},S=function(){var t=e.item.adaptiveCardDetails;if(t&&t.length>0){var n=t[0].card.messageCardContext;return n?{acCorrelationId:n.correlationId,actionType:Object(r.d)(t[0]),messageId:e.item.ItemId.Id,target:function(){return m}}:{acCorrelationId:"",actionType:void 0,messageId:null,target:function(){return m}}}return null},j=function(t){i.d.info("[MessageCardDebug] ActionableMessageContent fixInlineImages"),me(t,e.item.MailboxInfo),Ye(t,e.item,e.item.MailboxInfo)},T=function(t){i.d.info("[MessageCardDebug] ActionableMessageContent onCardRendered. Updating loading state"),m!==t&&(b(!0),h(t),k(!1)),e.viewState.showCardLoading&&He(e.viewState,!1)},x=function(e){return(null==e?void 0:e.actionType)&&null!=e.target?(i.d.info("[ActionableMessageCard] TeachingUI triggered"),xt.createElement(zt,Object(o.__assign)({},e))):null},k=function(t){l.current&&(clearTimeout(l.current),l.current=null);var n=e.viewState;He(n,!1),t&&Fe(n,!0)},w=e.item.adaptiveCardDetails;i.d.info("[MessageCardDebug] ActionableMessageContent render. itemId: "+e.item.ItemId.Id+". CardDetails: "+((null==w?void 0:w[0])?w[0].cardId:"undefined"));var E,_=w&&w.length>0,D=_&&(E=w[0].connectorSenderGuid,!Object(K.f)(In.b)&&E===Mn);return _?D||0!==function(t){var a=O(t);return 0!=(a=a.filter((function(t){return tn(t,e.item.MailboxInfo,Object(K.f)("rp-acDisableTransactionCard"),n.current,Ie)}))).length&&k(!0),a}(w).length?(k(!0),xt.createElement("div",null)):function(e){return!p.current&&xt.createElement(xt.Fragment,null,xt.createElement("div",{className:Sn.cardArea},y(e)),xt.createElement(On,{odataItemId:n.current.odataItemId,smtpAddressesSerialized:e[0].smtpAddressesSerialized}),g&&x(e?S():null))}(w):xt.createElement("div",null)}));n.d(t,"logAdaptiveCardLinkInteraction",(function(){return je})),n.d(t,"getCardDetails",(function(){return Le})),n.d(t,"ActionableMessageMailWrapper",(function(){return An})),n.d(t,"ActionableMessageContent",(function(){return jn})),n.d(t,"doesActionableMessageEnabled",(function(){return ge}))},1651:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a="cal-txp-invoice",r="cal-txp-serviceReservationAdaptive"},201:function(e){e.exports=JSON.parse('{"k":"qNa","h":"rNa","m":"sNa","j":"tNa","l":"uNa","i":"vNa","d":"wNa","b":"xNa","f":"yNa","g":"zNa","e":"ANa","a":"BNa","c":"CNa"}')},2165:function(e){e.exports=JSON.parse('{"a":"nOb"}')},247:function(e,t,n){"use strict";var a=n(502),r=n(503),i=n(504),o=n(505),s=n(506),c=n(507),d=n(508),u=n(490),l=n(491),p=n(492),f=n(493),g=n(494),b=n(495),C=n(496),m=n(497),h=n(498),v=n(499),O=n(500),y=n(501),A=n(201),I=n(530),M=n(518),S=n(519),j=n(520),T=n(521),x=n(522),k=n(523),w=n(524),E=n(525),_=n(526),D=n(527),R=n(528),P=n(529),N=n(7),L=n(13),U=function(){return F.get()},F=Object(L.computed)((function(){return{months:[Object(N.a)(y.a),Object(N.a)(O.a),Object(N.a)(v.a),Object(N.a)(h.a),Object(N.a)(m.a),Object(N.a)(C.a),Object(N.a)(b.a),Object(N.a)(g.a),Object(N.a)(f.a),Object(N.a)(p.a),Object(N.a)(l.a),Object(N.a)(u.a)],shortMonths:[Object(N.a)(P.a),Object(N.a)(R.a),Object(N.a)(D.a),Object(N.a)(_.a),Object(N.a)(E.a),Object(N.a)(w.a),Object(N.a)(k.a),Object(N.a)(x.a),Object(N.a)(T.a),Object(N.a)(j.a),Object(N.a)(S.a),Object(N.a)(M.a)],days:[Object(N.a)(d.a),Object(N.a)(c.a),Object(N.a)(s.a),Object(N.a)(o.a),Object(N.a)(i.a),Object(N.a)(r.a),Object(N.a)(a.a)],shortDays:[Object(N.a)(A.d),Object(N.a)(A.b),Object(N.a)(A.f),Object(N.a)(A.g),Object(N.a)(A.e),Object(N.a)(A.a),Object(N.a)(A.c)],goToToday:Object(N.a)(I.a),prevMonthAriaLabel:Object(N.a)(A.k),nextMonthAriaLabel:Object(N.a)(A.h),prevYearAriaLabel:Object(N.a)(A.m),nextYearAriaLabel:Object(N.a)(A.j),prevYearRangeAriaLabel:Object(N.a)(A.l),nextYearRangeAriaLabel:Object(N.a)(A.i)}})),H=n(74),B=function(e,t){return e?e.tz:t||Object(H.p)()},z=n(5),J=function(e,t){return Object(z.Qb)(e,t.getFullYear(),t.getMonth(),t.getDate())};n.d(t,"a",(function(){return U})),n.d(t,"c",(function(){return B})),n.d(t,"b",(function(){return J}))},2854:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(0),r=n(388),i=n(51),o=n(845);function s(e,t,n,s){var c=Object(r.e)(n,e,null,t),d=Object(a.__assign)(Object(a.__assign)({},s),{includeBohemiaOnPopout:Object(o.d)(o.a.Bohemia).bohemiaEnabled&&Object(i.f)("rp-prague")});Object(r.c)("mail",c,d,{resizable:!0})}},4577:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(6244),r=n(13),i=[{id:"ja7lKjj2NnQ.cwA.Krg.hfkh3ftaMUOb57AnI3gEJw-TZrkxQd1glDepIPKj6yo",tokenType:a.a.ConnectorsLTI},{id:"hXP0lB4sF4E.ihaAU12Q9puBSDe5dMnr8RITJalvWkCqiQadGVOHmIc",tokenType:a.a.AAD}],o=Object(r.computed)((function(){var e=new r.ObservableMap;return i.forEach((function(t){e.set(t.id,t)})),e}))},530:function(e){e.exports=JSON.parse('{"a":"pNa"}')},5429:function(e,t,n){"use strict";var a=n(13),r=n(4),i={themeStore:{loadStatus:0,themeMapping:{}},cards:new a.ObservableMap},o=Object(r.createStore)("ActionableMessageV2",i);t.a=o()},6244:function(e,t,n){"use strict";var a;!function(e){e.NoAuth="NoAuth",e.ConnectorsLTI="ConnectorsLTI",e.AAD="AAD"}(a||(a={})),t.a=a},8205:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var a=n(77),r=(n(4577),new a.c((function(){return Promise.all([n.e(8),n.e(40),n.e(73),n.e(647),n.e(391)]).then(n.bind(null,9175))}))),i=new a.b(r,(function(e){return e.openBotConversation})),o=new a.b(r,(function(e){return e.openCortanaConversation}));new a.a(r,(function(e){return e.setEditorInterface}))},8221:function(e){e.exports=JSON.parse('{"a":"Tac"}')},8222:function(e){e.exports=JSON.parse('{"a":"Uac"}')},8223:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return c}));var a=n(51),r=n(843),i=n(328),o=n(6072),s="MessageCard",c="IOpenTypedFacet.Com.Microsoft.Graph.MessageCard",d=Object(i.a)("E550B918-9859-47B9-8095-97E4E72F1926",c,"String"),u={featureId:s,propertyPaths:[d],isPropertyExistedOnItem:function(e){var t=r.a.items.get(e);return!!(null==t?void 0:t.adaptiveCardDetails)},shouldGetItemPropertiesFromServer:function(e,t){if(!Object(a.f)("rp-actionableMessages"))return!1;var n=r.a.items.get(e);return Object(o.a)(n)}};t.b=u},9029:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(4),r=Object(a.action)("setAutoInvokeActionAlreadyRan",(function(e,t){return{cardId:e,autoInvokeActionAlreadyRan:t}}))},9030:function(e,t,n){"use strict";var a;!function(e){e[e.LoadStart=0]="LoadStart",e[e.AutoInvokeActionStart=1]="AutoInvokeActionStart",e[e.AutoInvokeActionEnd=2]="AutoInvokeActionEnd",e[e.CardRenderStart=3]="CardRenderStart",e[e.CardRenderEnd=4]="CardRenderEnd",e[e.ThemeLoadTotalStart=5]="ThemeLoadTotalStart",e[e.ThemeLoadTotalEnd=6]="ThemeLoadTotalEnd",e[e.ThemeDefinitionsLoadStart=7]="ThemeDefinitionsLoadStart",e[e.ThemeDefinitionsLoadEnd=8]="ThemeDefinitionsLoadEnd",e[e.ThemeResolveStart=9]="ThemeResolveStart",e[e.ThemeResolveEnd=10]="ThemeResolveEnd",e[e.CardCreateStart=11]="CardCreateStart",e[e.CardCreateEnd=12]="CardCreateEnd",e[e.CardLibraryRenderStart=13]="CardLibraryRenderStart",e[e.CardLibraryRenderEnd=14]="CardLibraryRenderEnd",e[e.PrepareCardStart=15]="PrepareCardStart",e[e.PrepareCardEnd=16]="PrepareCardEnd"}(a||(a={})),t.a=a},9031:function(e,t,n){var a=n(12468),r=n(73);"string"==typeof a&&(a=[[e.i,a]]);for(var i=0;i<a.length;i++)r.loadStyles(a[i][1],!1);a.locals&&(e.exports=a.locals)}}]);
//# sourceMappingURL=owa.ActionableMessageMail.js.map
self.scriptsLoaded['owa.ActionableMessageMail.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.ActionableMessageMail.js'] = (new Date()).getTime();