self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SubstrateSuggestions.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[489],{1062:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(37);function o(){return Object(r.f)("rp-peopleSuggestionsTrie")&&Object(r.f)("rp-peopleSuggestionsCacheFirst")||Object(r.f)("rp-cacheFirstPeopleTrieSize300")||Object(r.f)("rp-cacheFirstPeopleTrieSize500")||Object(r.f)("rp-cacheFirstPeopleTrieSize700")||Object(r.f)("rp-peopleTrieOnTimeoutLow")||Object(r.f)("rp-peopleTrieOnTimeoutMed")||Object(r.f)("rp-peopleTrieOnTimeoutHigh")}},14141:function(t,e,n){"use strict";n.r(e);var r=n(4279),o=n(93),i=n(65),c=Object(o.action)("execute3SPrimeCall")((function(){Object(r.a)(Object(i.l)(),null,!1)}));n.d(e,"execute3SPrimeCall",(function(){return c}))},162:function(t,e,n){"use strict";var r,o=n(4),i=Object(o.action)("addAccount",(function(t){return{userIdentity:t.userIdentity,account:t}})),c=Object(o.action)("removeAccount",(function(t){return{userIdentity:t}})),u=Object(o.action)("updateAccount",(function(t,e,n){return{userIdentity:t,accountToken:e,accountTokenExpiresIn:n}})),a=Object(o.action)("updateOWAConnectedAccountStatus",(function(t,e){return{userIdentity:t,accountState:e}})),s=Object(o.action)("accountIsInErrorState",(function(t){return{accountState:t}})),d=n(0),f=n(12),l=n(5),b=n(193);!function(t){t[t.Valid=0]="Valid",t[t.AccountDeprovisioned=1]="AccountDeprovisioned",t[t.AccessRevoked=2]="AccessRevoked",t[t.TokenError=3]="TokenError",t[t.FailedToInitializeOWAConfig=4]="FailedToInitializeOWAConfig",t[t.AccountNotFound=5]="AccountNotFound"}(r||(r={})),Object(o.mutator)(i,(function(t){var e=t.account;e.accountState!=r.Valid&&Object(b.o)("OWAConnectedAccountStatusInvalid",{accountStatus_1:e.accountState}),p().accountsMap.set(e.userIdentity,e)})),Object(o.mutator)(c,(function(t){var e=t.userIdentity;p().accountsMap.delete(e)})),Object(o.mutator)(u,(function(t){var e=t.userIdentity,n=t.accountToken,r=t.accountTokenExpiresIn,o=p().accountsMap.get(e);o.token=n,o.tokenExpiry=Object(l.j)(Object(l.Pb)(),parseInt(r))})),Object(o.mutator)(a,(function(t){var e=t.userIdentity,n=t.accountState,o=p().accountsMap.get(e);o.accountState==r.Valid&&n!=r.Valid&&Object(b.o)("OWAConnectedAccountStatusInvalid",{accountStatus_1:n}),o.accountState=n}));var p=Object(o.createStore)("OWAAccountsStore",{accountsMap:new f.ObservableMap({})}),v=n(221);function O(t){return void 0!==j(t)}function S(){return Object(d.__spread)(p().accountsMap.values())}function j(t){return p().accountsMap.get(t)}function g(t){return S().filter((function(e){return e.accountProviderType==t}))}function y(t){return O(t)?j(t).accountProviderType:null}function h(t){return"Outlook"==t.accountProviderType?'MSAuth1.0 usertoken="'+t.token+'", type="MSACT"':"Google"==t.accountProviderType||"ICloud"==t.accountProviderType?"Bearer "+t.token:Object(v.a)(t.accountProviderType)}function A(t,e){return function(n){var r=j(n);return r?r[t]:e}}A("accountUniqueId","0");var I=A("accountState",r.Valid),m=function(){return S().some((function(t){return!M(t.userIdentity)}))},T=A("accountProviderType",null),x=function(t){return"Outlook"==T(t)},M=function(t){return I(t)==r.Valid};n.d(e,"c",(function(){return i})),n.d(e,"n",(function(){return c})),n.d(e,"p",(function(){return u})),n.d(e,"o",(function(){return a})),n.d(e,"b",(function(){return s})),n.d(e,"h",(function(){return S})),n.d(e,"e",(function(){return j})),n.d(e,"i",(function(){return g})),n.d(e,"d",(function(){return y})),n.d(e,"g",(function(){return h})),n.d(e,"f",(function(){return I})),n.d(e,"j",(function(){return m})),n.d(e,"m",(function(){return x})),n.d(e,"l",(function(){return M})),n.d(e,"k",(function(){return O})),n.d(e,"a",(function(){return r}))},256:function(t,e,n){"use strict";function r(t,e){Object.keys(e).forEach((function(n){return t.set(n,e[n])}))}function o(t){var e=t.requestOptions;return e||(e={headers:new Headers}),e.datapoint=e.datapoint||{},e.datapoint.mailbox="Default",e}n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return o}))},305:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return d}));var r=n(0),o=n(18),i=n(307),c=n(37),u=n(44);function a(t,e,n){var o,i;if(n)try{for(var c=Object(r.__values)(n),u=c.next();!u.done;u=c.next()){var a=u.value;if(!s(t,a))return a}}catch(t){o={error:t}}finally{try{u&&!u.done&&(i=c.return)&&i.call(c)}finally{if(o)throw o.error}}return e&&e.length>0?e[0]:"NoResolvableAddress@invalid.outlook.com"}function s(t,e){return("outlook_"+t+"@outlook.com").toLowerCase()===e.toLowerCase()}function d(){var t=function(){var t=Object(o.a)();if(!t||!t.SessionSettings)return u.d.error("SessionSettings not available"),"no-routing-key";var e=t.SessionSettings.UserEmailAddress;if(0===t.SessionSettings.WebSessionType)return Object(i.a)()+e;if(Object(c.f)("doc-attachment-routingKeyPuid"))return"PUID:"+t.SessionSettings.UserPuid+"@"+t.SessionSettings.TenantGuid;if(t.SessionSettings.IsShadowMailbox)return Object(i.a)()+t.SessionSettings.LogonEmailAddress;if(s(t.HexCID,t.SessionSettings.UserEmailAddress))return Object(i.a)()+a(t.HexCID,t.SessionSettings.NotManagedEmailAddresses,t.SessionSettings.UserProxyAddresses);return Object(i.a)()+e}();return t=encodeURIComponent(t)}},307:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(65),o=n(37),i=n(44);function c(t){var e=Object(r.i)(t);return e&&e.SessionSettings?0===e.SessionSettings.WebSessionType?Object(o.f)("doc-attachment-routingKeyAadSmtp")?"SMTP:":"":"MSA:":(i.d.error("SessionSettings not available"),"no-routing-key:")}},333:function(t,e,n){"use strict";var r=n(0),o=n(518),i=n(162),c=n(455),u=n(44),a="X-AnchorMailbox",s="Authorization",d="X-OwaWebSessionType",f="X-OWA-ExplicitLogonUser";function l(t,e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,l,b,p,v;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n={},!(l=Object(i.e)(t))||l.accountState!=i.a.AccountDeprovisioned&&l.accountState!=i.a.AccountNotFound?(e?(n[a]=e,n[f]=e):l&&(n[a]=l.anchorMailbox),l?(b=l.token,p=Object(c.g)(l.tokenExpiry),b||u.d.error("[getConnectedAccountHeaders] Invalid account token"),!p&&b?[3,2]:[4,o.a.importAndExecute(l.accountId,t)]):[3,3]):(Object(i.b)(l.accountState),[2,null]);case 1:(b=r.sent())||(b="",u.d.error("[getConnectedAccountHeaders] Token refresh failed")),r.label=2;case 2:v=void 0,"Outlook"==l.accountProviderType?(v='MSAuth1.0 usertoken="'+b+'", type="MSACT"',n[d]=1..toString()):"Google"!=l.accountProviderType&&"ICloud"!=l.accountProviderType||(v="Bearer "+b,n[d]=2..toString()),n[s]=v,r.label=3;case 3:return[2,n]}}))}))}var b=n(78),p=n(256);function v(t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return e=Object(p.a)(t),n=e,[4,O(t)];case 1:return n.headers=r.sent(),e.authNeededOnUnAuthorized=!1,e.datapoint=e.datapoint||{},e.datapoint.mailbox="Connected",[2,e]}}))}))}function O(t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return e=new Headers,[4,l(t.userIdentity,t.type==b.a.GroupMailbox||t.type==b.a.TeamsMailbox?t.mailboxSmtpAddress:null)];case 1:return n=r.sent(),Object(p.b)(e,n),[2,e]}}))}))}n.d(e,"a",(function(){return l})),n.d(e,"b",(function(){return v}))},3880:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(1062),o=["Id","ADObjectId","DisplayName","EmailAddresses","PeopleSubtype","PeopleType","PDLItemId","PersonaId","ImAddress","JobTitle"],i=o.concat(["FeatureData","GivenName","Alias"]),c=o.concat(["FeatureData"]);function u(t){return Object(r.a)()?0==t?i:c:o}},395:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(18),o=n(305),i=n(37),c=n(44);function u(){var t=Object(r.a)();if(!t||!t.SessionSettings)return c.d.error("SessionSettings not available"),"no-mailbox-id";var e=t.SessionSettings.UserEmailAddress;return Object(i.f)("doc-attachment-usePrimarySmtpAddressForMailboxId")?e:(t.SessionSettings.IsShadowMailbox?e=t.SessionSettings.LogonEmailAddress:Object(o.c)(t.HexCID,t.SessionSettings.UserEmailAddress)&&(e=Object(o.b)(t.HexCID,t.SessionSettings.NotManagedEmailAddresses,t.SessionSettings.UserProxyAddresses)),e)}},396:function(t,e,n){"use strict";var r;!function(t){t[t.UserMailbox=0]="UserMailbox",t[t.GroupMailbox=1]="GroupMailbox",t[t.TeamsMailbox=2]="TeamsMailbox"}(r||(r={})),e.a=r},400:function(t,e,n){"use strict";var r=n(4),o=n(12);e.a=Object(r.createStore)("OWAClientIdStore",{userMailboxInfoMap:new o.ObservableMap})},4279:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var r=n(0),o=n(162),i=n(333),c=n(37),u=n(452),a=n(190),s=n(198),d=n(208),f=n(3880),l=n(44),b=n(1062),p="/search/api/v1/init?",v="/search/api/v1/suggestions?",O="owa.react.compose",S="ClientSideRanker",j="ContextAwareServing",g="20",y="5";function h(t,e,n,o,i,c){return Object(r.__awaiter)(this,void 0,void 0,(function(){var a,d,f,b;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return null!=e?[3,1]:[2,A()];case 1:return[4,I(e,n,c)];case 2:return a=r.sent(),d=function(t,e){return{AppName:"OWA",Scenario:{Name:O},Cvid:e||Object(u.a)(),EntityRequests:[t]}}(a,null==i?void 0:i.conversationId),f=s.d,b=[v+T(e),d,o,!1],[4,x(t,null==i?void 0:i.clientSessionId)];case 3:return[2,f.apply(void 0,b.concat([r.sent(),!0,!0,!1])).then((function(t){return t})).catch((function(t){return l.d.info(t),null}))]}}))}))}function A(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,e;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return t=s.b,e=[p+T(),void 0,!0],[4,x(null)];case 1:return[2,t.apply(void 0,e.concat([n.sent(),!0,!1])).then((function(t){return Object(a.a)(t.status)?t.json():null})).catch((function(t){return l.d.error(t),null}))]}}))}))}function I(t,e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o;return Object(r.__generator)(this,(function(r){return o={Query:{QueryString:t},EntityType:"People",Provenances:m(e),Size:e?g:y},n&&n.length>0&&(o.Context=function(t){var e={};t&&(e.RecipientsTo=t.toString());return e}(n)),o.Fields=Object(f.a)(1),[2,o]}))}))}function m(t){var e=["Mailbox"];return t&&!Object(d.a)()&&e.push("Directory"),e}function T(t){var e={scenario:O};return Object(b.a)()&&(e.setflight=S),Object(c.f)("rp-contextualZeroQuery")&&""==t&&(e.setflight=j),Object.keys(e).map((function(t){return t+"="+e[t]})).join("&")}function x(t,e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){return n={},e&&(n["client-session-id"]=e),t&&Object(o.k)(t)?[2,Object(i.a)(t).then((function(t){return Object.keys(t).forEach((function(e){return n[e]=t[e]})),n}))]:[2,n]}))}))}},494:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(305),o=n(395),i=n(65),c=n(396),u=n(400);function a(t){var e=Object(u.a)().userMailboxInfoMap;if(!e||!e.get(t)){var n={type:c.a.UserMailbox,deprecatedMailboxId:t||Object(o.a)(),userIdentity:t||Object(i.c)(),mailboxSmtpAddress:t||Object(i.e)(),routingKey:Object(r.a)(),returnModernConversationItems:!1,requestOptions:null};return e.set(t,n),n}return e.get(t)}},518:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(73),o=new r.c((function(){return n.e(571).then(n.bind(null,800))})),i=new r.a(o,(function(t){return t.getAndUpdateAccessToken}))},78:function(t,e,n){"use strict";var r=n(395),o=n(494),i=n(400);function c(t){var e=Object(i.a)().userMailboxInfoMap;e&&e.delete(t)}function u(t,e){return t===e||null!=t&&null!=e&&t.Id===e.Id}var a=n(305),s=n(307),d=n(396);n.d(e,"d",(function(){return r.a})),n.d(e,"e",(function(){return o.a})),n.d(e,"g",(function(){return c})),n.d(e,"f",(function(){return u})),n.d(e,"b",(function(){return a.a})),n.d(e,"c",(function(){return s.a})),n.d(e,"a",(function(){return d.a}))}}]);
//# sourceMappingURL=owa.SubstrateSuggestions.js.map
self.scriptsLoaded['owa.SubstrateSuggestions.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SubstrateSuggestions.js'] = (new Date()).getTime();